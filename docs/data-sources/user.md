---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "ad_user Data Source - ad"
subcategory: ""
description: |-
  Retrieves information about an Active Directory user. Supports multiple lookup methods: objectGUID, Distinguished Name, User Principal Name (UPN), SAM account name, or Security Identifier (SID).
---

# ad_user (Data Source)

Retrieves information about an Active Directory user. Supports multiple lookup methods: objectGUID, Distinguished Name, User Principal Name (UPN), SAM account name, or Security Identifier (SID).

## Example Usage

```terraform
# AD User Data Source Example

terraform {
  required_providers {
    ad = {
      source = "isometry/ad"
    }
  }
}

provider "ad" {
  domain   = "example.com"
  username = "admin@example.com"
  password = "secure_password"
}

# Lookup user by SAM Account Name
data "ad_user" "by_sam" {
  sam_account_name = "jdoe"
}

# Lookup user by Distinguished Name
data "ad_user" "by_dn" {
  dn = "cn=John Doe,cn=users,dc=example,dc=com"
}

# Lookup user by User Principal Name (UPN)
data "ad_user" "by_upn" {
  upn = "john.doe@example.com"
}

# Lookup user by GUID
data "ad_user" "by_guid" {
  id = "12345678-1234-5678-9012-123456789012"
}

# Lookup user by SID
data "ad_user" "by_sid" {
  sid = "S-1-5-21-123456789-123456789-123456789-1001"
}

# Use user data for group membership
resource "ad_group_membership" "user_groups" {
  group_id = data.ad_group.it_team.id
  members = [
    data.ad_user.by_sam.dn,
    data.ad_user.by_upn.dn
  ]
}

# Reference to group for the membership example
data "ad_group" "it_team" {
  name = "IT Team"
}

# Create groups based on user attributes
resource "ad_group" "department_group" {
  name             = "${data.ad_user.by_sam.department} Department"
  sam_account_name = "${replace(data.ad_user.by_sam.department, " ", "")}Dept"
  container        = "ou=Department Groups,dc=example,dc=com"
  scope            = "Global"
  category         = "Security"
  description      = "Group for ${data.ad_user.by_sam.department} department members"
}

# Output user information
output "user_details" {
  value = {
    by_sam = {
      name             = data.ad_user.by_sam.display_name
      sam_account_name = data.ad_user.by_sam.sam_account_name
      upn              = data.ad_user.by_sam.upn
      dn               = data.ad_user.by_sam.dn
      email            = data.ad_user.by_sam.email
      department       = data.ad_user.by_sam.department
      title            = data.ad_user.by_sam.title
      office           = data.ad_user.by_sam.office
      telephone        = data.ad_user.by_sam.telephone
      enabled          = data.ad_user.by_sam.enabled
      sid              = data.ad_user.by_sam.sid
    }
    by_upn = {
      name             = data.ad_user.by_upn.display_name
      sam_account_name = data.ad_user.by_upn.sam_account_name
      dn               = data.ad_user.by_upn.dn
      manager          = data.ad_user.by_upn.manager
      department       = data.ad_user.by_upn.department
      company          = data.ad_user.by_upn.company
    }
  }
}

# Conditional logic based on user attributes
locals {
  is_manager = data.ad_user.by_sam.title != null ? contains(split(" ", lower(data.ad_user.by_sam.title)), "manager") : false
}

# Create manager-specific group if user is a manager
resource "ad_group" "managers_group" {
  count = local.is_manager ? 1 : 0

  name             = "Department Managers"
  sam_account_name = "DeptManagers"
  container        = "ou=Management Groups,dc=example,dc=com"
  scope            = "Global"
  category         = "Security"
  description      = "All department managers"
}

resource "ad_group_membership" "manager_membership" {
  count = local.is_manager ? 1 : 0

  group_id = ad_group.managers_group[0].id
  members  = [data.ad_user.by_sam.dn]
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Optional

- `dn` (String) The Distinguished Name of the user to retrieve. Example: `CN=John Doe,CN=Users,DC=example,DC=com`
- `id` (String) The objectGUID of the user to retrieve. This is the most reliable lookup method as objectGUIDs are immutable and unique. Format: `550e8400-e29b-41d4-a716-446655440000`
- `sam_account_name` (String) The SAM account name (pre-Windows 2000 name) of the user to retrieve. This performs a domain-wide search. Example: `jdoe`
- `sid` (String) The Security Identifier (SID) of the user to retrieve. Example: `S-1-5-21-123456789-123456789-123456789-1001`
- `upn` (String) The User Principal Name (UPN) of the user to retrieve. Example: `john.doe@example.com`

### Read-Only

- `account_enabled` (Boolean) Whether the user account is enabled.
- `account_expires` (String) When the user account expires (RFC3339 format).
- `account_locked_out` (Boolean) Whether the user account is locked out.
- `cannot_change_password` (Boolean) Whether the user cannot change their password.
- `change_password_at_logon` (Boolean) Whether the user must change password at next logon.
- `city` (String) The city/locality of the user.
- `company` (String) The company name of the user.
- `country` (String) The country of the user.
- `department` (String) The department of the user.
- `description` (String) The description of the user.
- `display_name` (String) The display name of the user.
- `division` (String) The division of the user.
- `email_address` (String) The primary email address of the user (mail attribute).
- `employee_id` (String) The employee ID of the user.
- `employee_number` (String) The employee number of the user.
- `fax` (String) The fax number of the user.
- `given_name` (String) The first name (given name) of the user.
- `home_directory` (String) The home directory path of the user.
- `home_drive` (String) The home drive letter of the user.
- `home_page` (String) The web page URL of the user.
- `home_phone` (String) The home telephone number of the user.
- `initials` (String) The middle initials of the user.
- `last_logon` (String) When the user last logged on (RFC3339 format).
- `logon_script` (String) The logon script path of the user.
- `manager` (String) The Distinguished Name of the user's manager.
- `member_of` (List of String) A list of Distinguished Names of groups this user is a member of.
- `mobile_phone` (String) The mobile telephone number of the user.
- `name` (String) The common name (cn) of the user.
- `object_guid` (String) The objectGUID of the user (immutable unique identifier).
- `object_sid` (String) The Security Identifier (SID) of the user.
- `office` (String) The physical office location of the user.
- `office_phone` (String) The office telephone number of the user.
- `organization` (String) The organization of the user.
- `password_last_set` (String) When the user's password was last set (RFC3339 format).
- `password_never_expires` (Boolean) Whether the user's password never expires.
- `password_not_required` (Boolean) Whether the user account requires a password.
- `po_box` (String) The P.O. Box of the user.
- `postal_code` (String) The ZIP/postal code of the user.
- `primary_group` (String) The Distinguished Name of the user's primary group.
- `profile_path` (String) The profile path of the user.
- `smart_card_logon_required` (Boolean) Whether the user requires smart card for logon.
- `state` (String) The state/province of the user.
- `street_address` (String) The street address of the user.
- `surname` (String) The last name (surname) of the user.
- `title` (String) The job title of the user.
- `trusted_for_delegation` (Boolean) Whether the user is trusted for delegation.
- `user_account_control` (Number) The raw Active Directory userAccountControl value as an integer.
- `when_changed` (String) When the user was last modified (RFC3339 format).
- `when_created` (String) When the user was created (RFC3339 format).
