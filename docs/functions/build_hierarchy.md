---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "build_hierarchy function - ad"
subcategory: ""
description: |-
  Build hierarchical tree structure from objects
---

# function: build_hierarchy

Organizes objects into a hierarchical tree structure based on parent-child or root relationships. Returns restructured objects with children grouped under their parents/roots.

The function preserves all original object attributes and adds hierarchical structure. Objects that have children will gain a children field containing a map of their child objects with keys preserved.

**Root Field Semantics:**
- `root: true` (boolean): Explicitly marks the object as a root
- `root: "name"` (string): References a root (creates it implicitly if it doesn't exist)
- Objects cannot have both `parent` and `root` fields (validation error)

**Configuration map fields (all optional):**
- `default_root` (string): Default root for objects without parent or root relationships
- `parent_field` (string): Field name for parent reference in objects (default: "parent")
- `root_field` (string): Field name for root reference/marking in objects (default: "root")
- `children_field` (string): Field name for children collection in output objects (default: "children")
- `max_depth` (number): Maximum allowed tree depth (default: 5)

## Example Usage

```terraform
# Build Hierarchy Function Examples

terraform {
  required_providers {
    ad = {
      source = "isometry/ad"
    }
  }
}

provider "ad" {
  domain   = "example.com"
  username = "admin@example.com"
  password = "secure_password"
}

# Basic organizational hierarchy
locals {
  departments = {
    "it" = {
      name = "IT Department"
    }
    "hr" = {
      name = "HR Department"
    }
    "dev-team" = {
      name   = "Development Team"
      parent = "it"
    }
    "ops-team" = {
      name   = "Operations Team"
      parent = "it"
    }
    "recruiting" = {
      name   = "Recruiting"
      parent = "hr"
    }
  }

  # Build hierarchy with default settings
  org_hierarchy = provider::ad::build_hierarchy(local.departments, {})
}

# Advanced example with custom field names
locals {
  projects = {
    "project-a" = {
      title   = "Project Alpha"
      manager = "john.doe"
    }
    "project-b" = {
      title   = "Project Beta"
      manager = "jane.smith"
    }
    "task-1" = {
      title      = "Database Design"
      reports_to = "project-a"
    }
    "task-2" = {
      title      = "API Development"
      reports_to = "project-a"
    }
    "task-3" = {
      title      = "Testing"
      reports_to = "project-b"
    }
  }

  # Custom configuration with different field names
  project_hierarchy = provider::ad::build_hierarchy(local.projects, {
    parent_field   = "reports_to"
    children_field = "tasks"
    max_depth      = 3
  })
}

# Expected result structure for org_hierarchy:
# {
#   "it" = {
#     name = "IT Department"
#     children = [
#       {
#         name = "Development Team"
#         parent = "it"
#       },
#       {
#         name = "Operations Team"
#         parent = "it"
#       }
#     ]
#   }
#   "hr" = {
#     name = "HR Department"
#     children = [
#       {
#         name = "Recruiting"
#         parent = "hr"
#       }
#     ]
#   }
#   "dev-team" = {
#     name = "Development Team"
#     parent = "it"
#   }
#   "ops-team" = {
#     name = "Operations Team"
#     parent = "it"
#   }
#   "recruiting" = {
#     name = "Recruiting"
#     parent = "hr"
#   }
# }

# Expected result structure for project_hierarchy:
# {
#   "project-a" = {
#     title = "Project Alpha"
#     manager = "john.doe"
#     tasks = [
#       {
#         title = "Database Design"
#         reports_to = "project-a"
#       },
#       {
#         title = "API Development"
#         reports_to = "project-a"
#       }
#     ]
#   }
#   "project-b" = {
#     title = "Project Beta"
#     manager = "jane.smith"
#     tasks = [
#       {
#         title = "Testing"
#         reports_to = "project-b"
#       }
#     ]
#   }
#   "task-1" = {
#     title = "Database Design"
#     reports_to = "project-a"
#   }
#   "task-2" = {
#     title = "API Development"
#     reports_to = "project-a"
#   }
#   "task-3" = {
#     title = "Testing"
#     reports_to = "project-b"
#   }
# }

# Output the hierarchical structures
output "organization" {
  value = local.org_hierarchy
}

output "projects" {
  value = local.project_hierarchy
}
```

## Signature

<!-- signature generated by tfplugindocs -->
```text
build_hierarchy(input dynamic, config dynamic) dynamic
```

## Arguments

<!-- arguments generated by tfplugindocs -->
1. `input` (Dynamic) Map with string keys and object values to organize into hierarchy. Each object can contain parent reference fields (linking to other object keys) or root fields (boolean `true` to mark as root, or string to reference/create roots).
1. `config` (Dynamic, Nullable) Optional configuration map controlling hierarchy building behavior. Can be null/empty to use defaults. Supports field name customization and depth limiting.

**Supported configuration keys:**
- `default_root` (string): Assigns this root value to objects that have no parent or explicit root relationship
- `parent_field` (string): Field name to look for parent references in input objects (default: "parent")
- `root_field` (string): Field name for root references/marking in objects (default: "root")
  - Boolean `true`: Explicitly marks object as root
  - String value: References a root (creates implicitly if needed)
- `children_field` (string): Field name for children collection in output objects (default: "children")
- `max_depth` (number): Maximum allowed tree depth to prevent infinite recursion (default: 5)
